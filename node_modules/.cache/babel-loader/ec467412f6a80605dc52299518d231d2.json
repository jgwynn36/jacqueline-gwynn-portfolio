{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { focusLocation, keyCodes, getActiveSelectedRange, tryAppendChange, emptyCell, scrollIntoView } from '.';\nimport { newLocation } from './newLocation';\nimport { areLocationsEqual } from './areLocationsEqual';\nimport { getCompatibleCellAndTemplate } from './getCompatibleCellAndTemplate';\nimport { isSelectionKey } from './isSelectionKey';\nexport function handleKeyDown(state, event) {\n  var newState = handleKeyDownInternal(state, event);\n\n  if (newState !== state) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  return newState;\n}\n\nfunction handleKeyDownInternal(state, event) {\n  var location = state.focusedLocation;\n  if (!location) return state;\n\n  var _a = getCompatibleCellAndTemplate(state, location),\n      cell = _a.cell,\n      cellTemplate = _a.cellTemplate;\n\n  if (cellTemplate.handleKeyDown && !state.currentlyEditedCell) {\n    var _b = cellTemplate.handleKeyDown(cell, event.keyCode, event.ctrlKey || event.metaKey, event.shiftKey, event.altKey),\n        newCell = _b.cell,\n        enableEditMode = _b.enableEditMode;\n\n    if (JSON.stringify(newCell) !== JSON.stringify(cell) || enableEditMode) {\n      if (enableEditMode) {\n        return __assign({}, state, {\n          currentlyEditedCell: newCell\n        });\n      } else {\n        return tryAppendChange(state, location, newCell);\n      }\n    }\n  }\n\n  if (event.altKey) return state;\n  var asr = getActiveSelectedRange(state);\n  var isSingleCellSelected = state.selectedRanges.length === 1 && areLocationsEqual(asr.first, asr.last);\n\n  if (isSelectionKey(event) && event.shiftKey) {\n    switch (event.keyCode) {\n      case keyCodes.HOME:\n        return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, 0, asr.last.row.idx);\n\n      case keyCodes.END:\n        return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, state.cellMatrix.last.row.idx);\n    }\n  } else if (isSelectionKey(event)) {\n    switch (event.keyCode) {\n      case keyCodes.KEY_A:\n        var cm = state.cellMatrix;\n        return __assign({}, state, {\n          selectedRanges: [cm.getRange(cm.first, cm.last)],\n          selectionMode: 'range',\n          activeSelectedRangeIdx: 0\n        });\n\n      case keyCodes.HOME:\n        return focusCell(0, 0, state);\n\n      case keyCodes.END:\n        return focusLocation(state, state.cellMatrix.last);\n\n      case keyCodes.SPACE:\n        return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, 0, state.cellMatrix.last.row.idx);\n    }\n  } else if (event.shiftKey) {\n    switch (event.keyCode) {\n      case keyCodes.UP_ARROW:\n        return resizeSelectionUp(state, asr, location);\n\n      case keyCodes.DOWN_ARROW:\n        return resizeSelectionDown(state, asr, location);\n\n      case keyCodes.LEFT_ARROW:\n        return resizeSelectionLeft(state, asr, location);\n\n      case keyCodes.RIGHT_ARROW:\n        return resizeSelectionRight(state, asr, location);\n\n      case keyCodes.TAB:\n        event.preventDefault();\n        return isSingleCellSelected ? moveFocusLeft(state) : moveFocusInsideSelectedRange(state, 'left', asr, location);\n\n      case keyCodes.ENTER:\n        state.hiddenFocusElement.focus();\n        return isSingleCellSelected ? moveFocusUp(state) : moveFocusInsideSelectedRange(state, 'up', asr, location);\n\n      case keyCodes.SPACE:\n        return resizeSelection(state, 0, state.cellMatrix.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n\n      case keyCodes.HOME:\n        return resizeSelection(state, 0, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n\n      case keyCodes.END:\n        return resizeSelection(state, asr.first.column.idx, state.cellMatrix.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n\n      case keyCodes.PAGE_UP:\n      case keyCodes.PAGE_DOWN:\n        return state;\n    }\n  } else {\n    switch (event.keyCode) {\n      case keyCodes.DELETE:\n        state.hiddenFocusElement.focus();\n\n      case keyCodes.BACKSPACE:\n        state.hiddenFocusElement.focus();\n        return wipeSelectedRanges(state);\n\n      case keyCodes.UP_ARROW:\n        state.hiddenFocusElement.focus();\n        return moveFocusUp(state);\n\n      case keyCodes.DOWN_ARROW:\n        state.hiddenFocusElement.focus();\n        return moveFocusDown(state);\n\n      case keyCodes.LEFT_ARROW:\n        state.hiddenFocusElement.focus();\n        return moveFocusLeft(state);\n\n      case keyCodes.RIGHT_ARROW:\n        state.hiddenFocusElement.focus();\n        return moveFocusRight(state);\n\n      case keyCodes.TAB:\n        state.hiddenFocusElement.focus();\n        event.preventDefault();\n        return isSingleCellSelected ? moveFocusRight(state) : moveFocusInsideSelectedRange(state, 'right', asr, location);\n\n      case keyCodes.HOME:\n        state.hiddenFocusElement.focus();\n        return state.focusedLocation ? focusCell(0, state.focusedLocation.row.idx, state) : state;\n\n      case keyCodes.END:\n        state.hiddenFocusElement.focus();\n        return state.focusedLocation ? focusCell(state.cellMatrix.columns.length - 1, state.focusedLocation.row.idx, state) : state;\n\n      case keyCodes.PAGE_UP:\n        state.hiddenFocusElement.focus();\n        return moveFocusPageUp(state);\n\n      case keyCodes.PAGE_DOWN:\n        state.hiddenFocusElement.focus();\n        return moveFocusPageDown(state);\n\n      case keyCodes.ENTER:\n        state.hiddenFocusElement.focus();\n        return isSingleCellSelected ? __assign({}, moveFocusDown(state), {\n          currentlyEditedCell: undefined\n        }) : moveFocusInsideSelectedRange(state, 'down', asr, location);\n\n      case keyCodes.ESCAPE:\n        event.preventDefault();\n        state.hiddenFocusElement.focus();\n        return state.currentlyEditedCell ? __assign({}, state, {\n          currentlyEditedCell: undefined\n        }) : state;\n    }\n  }\n\n  return state;\n}\n\nfunction focusCell(colIdx, rowIdx, state) {\n  var location = state.cellMatrix.getLocation(rowIdx, colIdx);\n  return focusLocation(state, location);\n}\n\nfunction moveFocusLeft(state) {\n  return state.focusedLocation && state.focusedLocation.column.idx > 0 ? focusCell(state.focusedLocation.column.idx - 1, state.focusedLocation.row.idx, state) : state;\n}\n\nfunction moveFocusRight(state) {\n  return state.focusedLocation && state.focusedLocation.column.idx < state.cellMatrix.last.column.idx ? focusCell(state.focusedLocation.column.idx + 1, state.focusedLocation.row.idx, state) : state;\n}\n\nfunction moveFocusUp(state) {\n  return state.focusedLocation && state.focusedLocation.row.idx > 0 ? focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx - 1, state) : state;\n}\n\nfunction moveFocusDown(state) {\n  if (state.focusedLocation) {\n    if (state.focusedLocation.row.idx == state.cellMatrix.last.row.idx) return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx, state);\n    return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx + 1, state);\n  }\n\n  return state;\n}\n\nfunction moveFocusPageUp(state) {\n  if (!state.focusedLocation) return state;\n  var rowsOnScreen = state.cellMatrix.rows.filter(function (row) {\n    return row.top < state.viewportElement.clientHeight;\n  });\n  return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx - rowsOnScreen.length > 0 ? state.focusedLocation.row.idx - rowsOnScreen.length : 0, state);\n}\n\nfunction moveFocusPageDown(state) {\n  if (!state.focusedLocation) return state;\n  var rowsOnScreen = state.cellMatrix.rows.slice(state.cellMatrix.frozenTopRange.rows.length, state.cellMatrix.rows.length - state.cellMatrix.frozenBottomRange.rows.length - 1).filter(function (row) {\n    return row.top + row.height < state.viewportElement.clientHeight;\n  });\n  return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx + rowsOnScreen.length < state.cellMatrix.rows.length ? state.focusedLocation.row.idx + rowsOnScreen.length - state.cellMatrix.frozenBottomRange.rows.length : state.cellMatrix.rows.length - 1, state);\n}\n\nfunction wipeSelectedRanges(state) {\n  state.selectedRanges.forEach(function (range) {\n    return range.rows.forEach(function (row) {\n      return range.columns.forEach(function (column) {\n        return state = tryAppendChange(state, {\n          row: row,\n          column: column\n        }, emptyCell);\n      });\n    });\n  });\n  return state;\n}\n\nfunction moveFocusInsideSelectedRange(state, direction, asr, location) {\n  var selectedRangeIdx = state.activeSelectedRangeIdx;\n  var colCount = asr ? asr.columns.length : 0;\n  var rowCount = asr ? asr.rows.length : 0;\n  var delta = direction === 'up' || direction === 'left' ? -1 : 1;\n  var currentPosInRange = direction === 'up' || direction === 'down' ? location.row.idx - asr.first.row.idx + (location.column.idx - asr.first.column.idx) * rowCount : (location.row.idx - asr.first.row.idx) * colCount + (location.column.idx - asr.first.column.idx);\n  var newPosInRange = (currentPosInRange + delta) % (asr.rows.length * asr.columns.length);\n\n  if (newPosInRange < 0 && currentPosInRange === 0) {\n    var nextSelectionRangeIdx = selectedRangeIdx === 0 ? state.selectedRanges.length - 1 : (selectedRangeIdx - 1) % state.selectedRanges.length;\n    var nextSelection = state.selectedRanges[nextSelectionRangeIdx];\n    state = focusLocation(state, newLocation(nextSelection.last.row, nextSelection.last.column), false);\n    return __assign({}, state, {\n      activeSelectedRangeIdx: nextSelectionRangeIdx\n    });\n  } else if (newPosInRange === 0 && currentPosInRange === asr.rows.length * asr.columns.length - 1) {\n    var nextSelectionRangeIdx = (selectedRangeIdx + 1) % state.selectedRanges.length;\n    var nextSelection = state.selectedRanges[nextSelectionRangeIdx];\n    state = focusLocation(state, newLocation(nextSelection.first.row, nextSelection.first.column), false);\n    return __assign({}, state, {\n      activeSelectedRangeIdx: nextSelectionRangeIdx\n    });\n  } else {\n    var focusedCellColIdxInRange = direction === 'up' || direction === 'down' ? Math.floor(newPosInRange / rowCount) : newPosInRange % colCount;\n    var focusedCellRowIdxInRange = direction === 'up' || direction === 'down' ? newPosInRange % rowCount : Math.floor(newPosInRange / colCount);\n    var focusedCellColIdx = asr.first.column.idx + focusedCellColIdxInRange;\n    var focusedCellRowIdx = asr.first.row.idx + focusedCellRowIdxInRange;\n    state = focusLocation(state, state.cellMatrix.getLocation(focusedCellRowIdx, focusedCellColIdx), asr ? asr.columns.length > 1 || asr.rows.length > 1 ? false : true : true);\n    return state;\n  }\n}\n\nfunction resizeSelectionUp(state, asr, location) {\n  return asr.first.row.idx >= 0 ? asr.last.row.idx > location.row.idx ? resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx > 0 ? asr.last.row.idx - 1 : 0, 'up') : resizeSelection(state, asr.last.column.idx, asr.first.column.idx, asr.last.row.idx, asr.first.row.idx > 0 ? asr.first.row.idx - 1 : 0, 'up') : state;\n}\n\nfunction resizeSelectionDown(state, asr, location) {\n  return asr.last.row.idx <= state.cellMatrix.last.row.idx ? asr.first.row.idx < location.row.idx ? resizeSelection(state, asr.last.column.idx, asr.first.column.idx, asr.last.row.idx, asr.first.row.idx >= state.cellMatrix.last.row.idx ? state.cellMatrix.last.row.idx : asr.first.row.idx + 1, 'down') : resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx >= state.cellMatrix.last.row.idx ? state.cellMatrix.last.row.idx : asr.last.row.idx + 1, 'down') : state;\n}\n\nfunction resizeSelectionLeft(state, asr, location) {\n  return asr.first.column.idx >= 0 ? asr.last.column.idx > location.column.idx ? resizeSelection(state, asr.first.column.idx, asr.last.column.idx > 0 ? asr.last.column.idx - 1 : 0, asr.first.row.idx, asr.last.row.idx, 'left') : resizeSelection(state, asr.last.column.idx, asr.first.column.idx > 0 ? asr.first.column.idx - 1 : 0, asr.last.row.idx, asr.first.row.idx, 'left') : state;\n}\n\nfunction resizeSelectionRight(state, asr, location) {\n  return asr.last.column.idx <= state.cellMatrix.last.column.idx ? asr.first.column.idx < location.column.idx ? resizeSelection(state, asr.last.column.idx, asr.first.column.idx >= state.cellMatrix.last.column.idx ? state.cellMatrix.last.column.idx : asr.first.column.idx + 1, asr.last.row.idx, asr.first.row.idx, 'right') : resizeSelection(state, asr.first.column.idx, asr.last.column.idx >= state.cellMatrix.last.column.idx ? state.cellMatrix.last.column.idx : asr.last.column.idx + 1, asr.first.row.idx, asr.last.row.idx, 'right') : state;\n}\n\nfunction resizeSelection(state, firstColIdx, lastColIdx, firstRowIdx, lastRowIdx, scrollDirection) {\n  if (state.disableRangeSelection) return state;\n  var start = state.cellMatrix.getLocation(firstRowIdx, firstColIdx);\n  var end = state.cellMatrix.getLocation(lastRowIdx, lastColIdx);\n  var selectedRanges = state.selectedRanges.slice();\n  selectedRanges[state.activeSelectedRangeIdx] = state.cellMatrix.getRange(start, end);\n\n  if (scrollDirection) {\n    var location_1 = state.focusedLocation;\n\n    switch (scrollDirection) {\n      case 'left':\n      case 'right':\n        var colIdx = location_1.column.idx !== firstColIdx ? firstColIdx : lastColIdx;\n        scrollIntoView(state, state.cellMatrix.getLocation(location_1.row.idx, colIdx), 'horizontal');\n        break;\n\n      case 'up':\n      case 'down':\n        var rowIdx = location_1.row.idx !== firstRowIdx ? firstRowIdx : lastRowIdx;\n        scrollIntoView(state, state.cellMatrix.getLocation(rowIdx, location_1.column.idx), 'vertical');\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  return __assign({}, state, {\n    selectedRanges: selectedRanges\n  });\n}","map":{"version":3,"sources":["/Users/jacquelinegwynn/jacquelinegwynn-portfolio/node_modules/@silevis/reactgrid/dist/lib/Functions/handleKeyDown.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","focusLocation","keyCodes","getActiveSelectedRange","tryAppendChange","emptyCell","scrollIntoView","newLocation","areLocationsEqual","getCompatibleCellAndTemplate","isSelectionKey","handleKeyDown","state","event","newState","handleKeyDownInternal","stopPropagation","preventDefault","location","focusedLocation","_a","cell","cellTemplate","currentlyEditedCell","_b","keyCode","ctrlKey","metaKey","shiftKey","altKey","newCell","enableEditMode","JSON","stringify","asr","isSingleCellSelected","selectedRanges","first","last","HOME","resizeSelection","column","idx","row","END","cellMatrix","KEY_A","cm","getRange","selectionMode","activeSelectedRangeIdx","focusCell","SPACE","UP_ARROW","resizeSelectionUp","DOWN_ARROW","resizeSelectionDown","LEFT_ARROW","resizeSelectionLeft","RIGHT_ARROW","resizeSelectionRight","TAB","moveFocusLeft","moveFocusInsideSelectedRange","ENTER","hiddenFocusElement","focus","moveFocusUp","PAGE_UP","PAGE_DOWN","DELETE","BACKSPACE","wipeSelectedRanges","moveFocusDown","moveFocusRight","columns","moveFocusPageUp","moveFocusPageDown","undefined","ESCAPE","colIdx","rowIdx","getLocation","rowsOnScreen","rows","filter","top","viewportElement","clientHeight","slice","frozenTopRange","frozenBottomRange","height","forEach","range","direction","selectedRangeIdx","colCount","rowCount","delta","currentPosInRange","newPosInRange","nextSelectionRangeIdx","nextSelection","focusedCellColIdxInRange","Math","floor","focusedCellRowIdxInRange","focusedCellColIdx","focusedCellRowIdx","firstColIdx","lastColIdx","firstRowIdx","lastRowIdx","scrollDirection","disableRangeSelection","start","end","location_1"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { focusLocation, keyCodes, getActiveSelectedRange, tryAppendChange, emptyCell, scrollIntoView } from '.';\nimport { newLocation } from './newLocation';\nimport { areLocationsEqual } from './areLocationsEqual';\nimport { getCompatibleCellAndTemplate } from './getCompatibleCellAndTemplate';\nimport { isSelectionKey } from './isSelectionKey';\nexport function handleKeyDown(state, event) {\n    var newState = handleKeyDownInternal(state, event);\n    if (newState !== state) {\n        event.stopPropagation();\n        event.preventDefault();\n    }\n    return newState;\n}\nfunction handleKeyDownInternal(state, event) {\n    var location = state.focusedLocation;\n    if (!location)\n        return state;\n    var _a = getCompatibleCellAndTemplate(state, location), cell = _a.cell, cellTemplate = _a.cellTemplate;\n    if (cellTemplate.handleKeyDown && !state.currentlyEditedCell) {\n        var _b = cellTemplate.handleKeyDown(cell, event.keyCode, event.ctrlKey || event.metaKey, event.shiftKey, event.altKey), newCell = _b.cell, enableEditMode = _b.enableEditMode;\n        if (JSON.stringify(newCell) !== JSON.stringify(cell) || enableEditMode) {\n            if (enableEditMode) {\n                return __assign({}, state, { currentlyEditedCell: newCell });\n            }\n            else {\n                return tryAppendChange(state, location, newCell);\n            }\n        }\n    }\n    if (event.altKey)\n        return state;\n    var asr = getActiveSelectedRange(state);\n    var isSingleCellSelected = state.selectedRanges.length === 1 && areLocationsEqual(asr.first, asr.last);\n    if (isSelectionKey(event) && event.shiftKey) {\n        switch (event.keyCode) {\n            case keyCodes.HOME:\n                return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, 0, asr.last.row.idx);\n            case keyCodes.END:\n                return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, state.cellMatrix.last.row.idx);\n        }\n    }\n    else if (isSelectionKey(event)) {\n        switch (event.keyCode) {\n            case keyCodes.KEY_A:\n                var cm = state.cellMatrix;\n                return __assign({}, state, { selectedRanges: [cm.getRange(cm.first, cm.last)], selectionMode: 'range', activeSelectedRangeIdx: 0 });\n            case keyCodes.HOME:\n                return focusCell(0, 0, state);\n            case keyCodes.END:\n                return focusLocation(state, state.cellMatrix.last);\n            case keyCodes.SPACE:\n                return resizeSelection(state, asr.first.column.idx, asr.last.column.idx, 0, state.cellMatrix.last.row.idx);\n        }\n    }\n    else if (event.shiftKey) {\n        switch (event.keyCode) {\n            case keyCodes.UP_ARROW:\n                return resizeSelectionUp(state, asr, location);\n            case keyCodes.DOWN_ARROW:\n                return resizeSelectionDown(state, asr, location);\n            case keyCodes.LEFT_ARROW:\n                return resizeSelectionLeft(state, asr, location);\n            case keyCodes.RIGHT_ARROW:\n                return resizeSelectionRight(state, asr, location);\n            case keyCodes.TAB:\n                event.preventDefault();\n                return isSingleCellSelected ? moveFocusLeft(state) : moveFocusInsideSelectedRange(state, 'left', asr, location);\n            case keyCodes.ENTER:\n                state.hiddenFocusElement.focus();\n                return isSingleCellSelected ?\n                    moveFocusUp(state) :\n                    moveFocusInsideSelectedRange(state, 'up', asr, location);\n            case keyCodes.SPACE:\n                return resizeSelection(state, 0, state.cellMatrix.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n            case keyCodes.HOME:\n                return resizeSelection(state, 0, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n            case keyCodes.END:\n                return resizeSelection(state, asr.first.column.idx, state.cellMatrix.last.column.idx, asr.first.row.idx, asr.last.row.idx);\n            case keyCodes.PAGE_UP:\n            case keyCodes.PAGE_DOWN:\n                return state;\n        }\n    }\n    else {\n        switch (event.keyCode) {\n            case keyCodes.DELETE:\n                state.hiddenFocusElement.focus();\n            case keyCodes.BACKSPACE:\n                state.hiddenFocusElement.focus();\n                return wipeSelectedRanges(state);\n            case keyCodes.UP_ARROW:\n                state.hiddenFocusElement.focus();\n                return moveFocusUp(state);\n            case keyCodes.DOWN_ARROW:\n                state.hiddenFocusElement.focus();\n                return moveFocusDown(state);\n            case keyCodes.LEFT_ARROW:\n                state.hiddenFocusElement.focus();\n                return moveFocusLeft(state);\n            case keyCodes.RIGHT_ARROW:\n                state.hiddenFocusElement.focus();\n                return moveFocusRight(state);\n            case keyCodes.TAB:\n                state.hiddenFocusElement.focus();\n                event.preventDefault();\n                return isSingleCellSelected ? moveFocusRight(state) : moveFocusInsideSelectedRange(state, 'right', asr, location);\n            case keyCodes.HOME:\n                state.hiddenFocusElement.focus();\n                return (state.focusedLocation) ? focusCell(0, state.focusedLocation.row.idx, state) : state;\n            case keyCodes.END:\n                state.hiddenFocusElement.focus();\n                return (state.focusedLocation) ? focusCell(state.cellMatrix.columns.length - 1, state.focusedLocation.row.idx, state) : state;\n            case keyCodes.PAGE_UP:\n                state.hiddenFocusElement.focus();\n                return moveFocusPageUp(state);\n            case keyCodes.PAGE_DOWN:\n                state.hiddenFocusElement.focus();\n                return moveFocusPageDown(state);\n            case keyCodes.ENTER:\n                state.hiddenFocusElement.focus();\n                return isSingleCellSelected ? __assign({}, moveFocusDown(state), { currentlyEditedCell: undefined }) :\n                    moveFocusInsideSelectedRange(state, 'down', asr, location);\n            case keyCodes.ESCAPE:\n                event.preventDefault();\n                state.hiddenFocusElement.focus();\n                return (state.currentlyEditedCell) ? __assign({}, state, { currentlyEditedCell: undefined }) : state;\n        }\n    }\n    return state;\n}\nfunction focusCell(colIdx, rowIdx, state) {\n    var location = state.cellMatrix.getLocation(rowIdx, colIdx);\n    return focusLocation(state, location);\n}\nfunction moveFocusLeft(state) {\n    return (state.focusedLocation && state.focusedLocation.column.idx > 0) ?\n        focusCell(state.focusedLocation.column.idx - 1, state.focusedLocation.row.idx, state) : state;\n}\nfunction moveFocusRight(state) {\n    return (state.focusedLocation && state.focusedLocation.column.idx < state.cellMatrix.last.column.idx) ?\n        focusCell(state.focusedLocation.column.idx + 1, state.focusedLocation.row.idx, state) : state;\n}\nfunction moveFocusUp(state) {\n    return (state.focusedLocation && state.focusedLocation.row.idx > 0) ?\n        focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx - 1, state) : state;\n}\nfunction moveFocusDown(state) {\n    if (state.focusedLocation) {\n        if (state.focusedLocation.row.idx == state.cellMatrix.last.row.idx)\n            return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx, state);\n        return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx + 1, state);\n    }\n    return state;\n}\nfunction moveFocusPageUp(state) {\n    if (!state.focusedLocation)\n        return state;\n    var rowsOnScreen = state.cellMatrix.rows.filter(function (row) { return row.top < state.viewportElement.clientHeight; });\n    return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx - rowsOnScreen.length > 0\n        ? state.focusedLocation.row.idx - rowsOnScreen.length\n        : 0, state);\n}\nfunction moveFocusPageDown(state) {\n    if (!state.focusedLocation)\n        return state;\n    var rowsOnScreen = state.cellMatrix.rows\n        .slice(state.cellMatrix.frozenTopRange.rows.length, state.cellMatrix.rows.length -\n        state.cellMatrix.frozenBottomRange.rows.length -\n        1)\n        .filter(function (row) { return row.top + row.height < state.viewportElement.clientHeight; });\n    return focusCell(state.focusedLocation.column.idx, state.focusedLocation.row.idx + rowsOnScreen.length < state.cellMatrix.rows.length\n        ? state.focusedLocation.row.idx +\n            rowsOnScreen.length -\n            state.cellMatrix.frozenBottomRange.rows.length\n        : state.cellMatrix.rows.length - 1, state);\n}\nfunction wipeSelectedRanges(state) {\n    state.selectedRanges.forEach(function (range) {\n        return range.rows.forEach(function (row) {\n            return range.columns.forEach(function (column) {\n                return state = tryAppendChange(state, { row: row, column: column }, emptyCell);\n            });\n        });\n    });\n    return state;\n}\nfunction moveFocusInsideSelectedRange(state, direction, asr, location) {\n    var selectedRangeIdx = state.activeSelectedRangeIdx;\n    var colCount = asr ? asr.columns.length : 0;\n    var rowCount = asr ? asr.rows.length : 0;\n    var delta = direction === 'up' || direction === 'left' ? -1 : 1;\n    var currentPosInRange = direction === 'up' || direction === 'down'\n        ? (location.row.idx - asr.first.row.idx) +\n            (location.column.idx - asr.first.column.idx) * rowCount\n        : (location.row.idx - asr.first.row.idx) * colCount +\n            (location.column.idx - asr.first.column.idx);\n    var newPosInRange = (currentPosInRange + delta) % (asr.rows.length * asr.columns.length);\n    if ((newPosInRange < 0 && currentPosInRange === 0)) {\n        var nextSelectionRangeIdx = selectedRangeIdx === 0 ? state.selectedRanges.length - 1 : (selectedRangeIdx - 1) % state.selectedRanges.length;\n        var nextSelection = state.selectedRanges[nextSelectionRangeIdx];\n        state = focusLocation(state, newLocation(nextSelection.last.row, nextSelection.last.column), false);\n        return __assign({}, state, { activeSelectedRangeIdx: nextSelectionRangeIdx });\n    }\n    else if (newPosInRange === 0 && currentPosInRange === (asr.rows.length * asr.columns.length) - 1) {\n        var nextSelectionRangeIdx = (selectedRangeIdx + 1) % state.selectedRanges.length;\n        var nextSelection = state.selectedRanges[nextSelectionRangeIdx];\n        state = focusLocation(state, newLocation(nextSelection.first.row, nextSelection.first.column), false);\n        return __assign({}, state, { activeSelectedRangeIdx: nextSelectionRangeIdx });\n    }\n    else {\n        var focusedCellColIdxInRange = direction === 'up' || direction === 'down' ? Math.floor(newPosInRange / rowCount) : newPosInRange % colCount;\n        var focusedCellRowIdxInRange = direction === 'up' || direction === 'down' ? newPosInRange % rowCount : Math.floor(newPosInRange / colCount);\n        var focusedCellColIdx = asr.first.column.idx + focusedCellColIdxInRange;\n        var focusedCellRowIdx = asr.first.row.idx + focusedCellRowIdxInRange;\n        state = focusLocation(state, state.cellMatrix.getLocation(focusedCellRowIdx, focusedCellColIdx), asr ? (asr.columns.length > 1 || asr.rows.length > 1 ? false : true) : true);\n        return state;\n    }\n}\nfunction resizeSelectionUp(state, asr, location) {\n    return (asr.first.row.idx >= 0) ?\n        (asr.last.row.idx > location.row.idx) ?\n            resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx > 0 ? asr.last.row.idx - 1 : 0, 'up') :\n            resizeSelection(state, asr.last.column.idx, asr.first.column.idx, asr.last.row.idx, asr.first.row.idx > 0 ? asr.first.row.idx - 1 : 0, 'up') :\n        state;\n}\nfunction resizeSelectionDown(state, asr, location) {\n    return (asr.last.row.idx <= state.cellMatrix.last.row.idx) ?\n        (asr.first.row.idx < location.row.idx) ?\n            resizeSelection(state, asr.last.column.idx, asr.first.column.idx, asr.last.row.idx, asr.first.row.idx >= state.cellMatrix.last.row.idx ? state.cellMatrix.last.row.idx : asr.first.row.idx + 1, 'down') :\n            resizeSelection(state, asr.first.column.idx, asr.last.column.idx, asr.first.row.idx, asr.last.row.idx >= state.cellMatrix.last.row.idx ? state.cellMatrix.last.row.idx : asr.last.row.idx + 1, 'down') :\n        state;\n}\nfunction resizeSelectionLeft(state, asr, location) {\n    return (asr.first.column.idx >= 0) ?\n        (asr.last.column.idx > location.column.idx) ?\n            resizeSelection(state, asr.first.column.idx, asr.last.column.idx > 0 ? asr.last.column.idx - 1 : 0, asr.first.row.idx, asr.last.row.idx, 'left') :\n            resizeSelection(state, asr.last.column.idx, asr.first.column.idx > 0 ? asr.first.column.idx - 1 : 0, asr.last.row.idx, asr.first.row.idx, 'left') :\n        state;\n}\nfunction resizeSelectionRight(state, asr, location) {\n    return (asr.last.column.idx <= state.cellMatrix.last.column.idx) ?\n        (asr.first.column.idx < location.column.idx) ?\n            resizeSelection(state, asr.last.column.idx, asr.first.column.idx >= state.cellMatrix.last.column.idx ? state.cellMatrix.last.column.idx : asr.first.column.idx + 1, asr.last.row.idx, asr.first.row.idx, 'right') :\n            resizeSelection(state, asr.first.column.idx, asr.last.column.idx >= state.cellMatrix.last.column.idx ? state.cellMatrix.last.column.idx : asr.last.column.idx + 1, asr.first.row.idx, asr.last.row.idx, 'right') :\n        state;\n}\nfunction resizeSelection(state, firstColIdx, lastColIdx, firstRowIdx, lastRowIdx, scrollDirection) {\n    if (state.disableRangeSelection)\n        return state;\n    var start = state.cellMatrix.getLocation(firstRowIdx, firstColIdx);\n    var end = state.cellMatrix.getLocation(lastRowIdx, lastColIdx);\n    var selectedRanges = state.selectedRanges.slice();\n    selectedRanges[state.activeSelectedRangeIdx] = state.cellMatrix.getRange(start, end);\n    if (scrollDirection) {\n        var location_1 = state.focusedLocation;\n        switch (scrollDirection) {\n            case 'left':\n            case 'right':\n                var colIdx = location_1.column.idx !== firstColIdx ? firstColIdx : lastColIdx;\n                scrollIntoView(state, state.cellMatrix.getLocation(location_1.row.idx, colIdx), 'horizontal');\n                break;\n            case 'up':\n            case 'down':\n                var rowIdx = location_1.row.idx !== firstRowIdx ? firstRowIdx : lastRowIdx;\n                scrollIntoView(state, state.cellMatrix.getLocation(rowIdx, location_1.column.idx), 'vertical');\n                break;\n            default:\n                break;\n        }\n    }\n    return __assign({}, state, { selectedRanges: selectedRanges });\n}\n"]},"metadata":{},"sourceType":"module"}